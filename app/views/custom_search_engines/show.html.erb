<% provide :title, @query %>

<div class="container">
<div class="row">
	<div class="span2"><p>You Search I Search</p></div>
	<div class="span10">
		<!-- cse search box start -->
		<div class="cse-search-box-wrapper">
		<%= render 'custom_search_engines/cse_search_box' %>
		</div>
		<!-- cse search box end -->
	</div>
</div>

<div class="row">
	<div class="span2" id="cse-recommend-side" style="display: none">
		<!-- cse search recommend start -->
		<%= render 'custom_search_engines/cse_recommend_side' %>
		<!-- cse search recommend end -->		
	</div>
	<div class="span7">
		<!-- cse search result start -->
		<div class="row-fluid"><div id="cse-result"></div></div>
		<!-- cse search result end -->
	</div>
	<div class="span3" id="cse-ads" style="display: none">Ads</div>
</div>
</div>

<% content_for :head_script do %>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33845460-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<% end %>

<% content_for :body_bottom_script do %>
<script type="text/javascript">
	function showSidebar(){
		$('#cse-recommend-side').show();
		$('#cse-ads').show();
	}

	var myCallback = function() {
	  if (document.readyState == 'complete') {
	    // Document is ready when CSE element is initialized.
	    showSidebar();
	    google.search.cse.element.render(
	        {
	          div: "cse-result",
	          tag: 'searchresults-only'
	         }).execute('<%= @query %>');
	  } else {
	    // Document is not ready yet, when CSE element is initialized.
	    showSidebar();
	    google.setOnLoadCallback(function() {
	        google.search.cse.element.render(
	            {
	              div: "cse-result",
	              tag: 'searchresults-only'
	            }).execute('<%= @query %>');
	    }, true);
	  }
	};

	// Insert it before the CSE code snippet so that cse.js can take the script
	// parameters, like parsetags, callbacks.
	window.__gcse = {
	  parsetags: 'explicit',
	  callback: myCallback
	};
	(function() {
	    var cx = '016210554812953211518:2rcjzygztzs'; // Insert your own Custom Search engine ID here
	    //var cref = 'http://www.guha.com/cref_cse.xml';
	    var gcse = document.createElement('script'); 
	    gcse.type = 'text/javascript';
	    gcse.async = true;
	    //gcse.src = (document.location.protocol == 'https' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cref=' + cref;
	  gcse.src = (document.location.protocol == 'https' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
	    var s = document.getElementsByTagName('script')[0]; 
	    s.parentNode.insertBefore(gcse, s);
	  
	  //bind search button
	  $("#cse-go").click(function(){
	    $("#cse-result").html('');
	    var q = $("#cse-query").val();
	    if(q){
	      window.location = '/q/' + q;
	    }
	  });

	 })();
</script>
 <% end %>
